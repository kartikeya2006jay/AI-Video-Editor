"use client"

import { useState, useRef, useEffect } from "react"
import { Upload, Loader2, Video, Sparkles, Download, Play, Settings, Volume2, Captions, Zap, Shield, Clock, FileVideo, Bold, Italic, Type, Palette, Save, Droplets, Check, ChevronRight, Wand2, Image as ImageIcon, X, Trash2, Edit2, Eye, EyeOff, Maximize2, Minus, Plus, RotateCw, Grid, AlignCenter, AlignLeft, AlignRight, Underline, Strikethrough, TextCursor, Layers, PaintBucket, Copy, Share2, Zap as Lightning, BarChart3, Globe, FileText, Cloud, Smartphone, Tv, Link, Users, Command, Clock as ClockIcon, Airplay, GanttChart, Palette as PaletteIcon, Brain, Table, ArrowUpDown, Filter, PieChart, TrendingUp, Cpu, ShieldCheck, SmartphoneIcon } from "lucide-react"

interface ThemeSettings {
  captions: {
    bold: boolean
    italic: boolean
    underline: boolean
    strikethrough: boolean
    fontSize: number
    fontColor: string
    backgroundColor: string
    backgroundOpacity: number
    position: 'top' | 'middle' | 'bottom'
    textAlign: 'left' | 'center' | 'right'
    borderColor: string
    borderWidth: number
    borderRadius: number
    shadowColor: string
    shadowBlur: number
    shadowOffsetX: number
    shadowOffsetY: number
    fontFamily: string
    letterSpacing: number
    lineHeight: number
    textTransform: 'none' | 'uppercase' | 'lowercase' | 'capitalize'
    padding: number
    margin: number
    transition: 'none' | 'fade' | 'slide' | 'zoom'
    animationSpeed: number
    maxWidth: number
    multiline: boolean
  }
  video: {
    brightness: number
    contrast: number
    saturation: number
    volume: number
  }
}

interface Subtitle {
  id: string
  text: string
  startTime: number
  endTime: number
  style?: Partial<ThemeSettings['captions']>
  isAutoGenerated?: boolean
  confidence?: number
  speaker?: string
}

interface CaptionTemplate {
  id: string
  name: string
  description: string
  style: Partial<ThemeSettings['captions']>
  icon: string
  category: 'professional' | 'casual' | 'creative' | 'minimal'
}

// Extended color palettes
const FONT_COLOR_PRESETS = [
  { name: "White", value: "#FFFFFF", textColor: "#000000" },
  { name: "Black", value: "#000000", textColor: "#FFFFFF" },
  { name: "Red", value: "#FF0000", textColor: "#FFFFFF" },
  { name: "Blue", value: "#0000FF", textColor: "#FFFFFF" },
  { name: "Green", value: "#00FF00", textColor: "#000000" },
  { name: "Yellow", value: "#FFFF00", textColor: "#000000" },
  { name: "Orange", value: "#FFA500", textColor: "#000000" },
  { name: "Purple", value: "#800080", textColor: "#FFFFFF" },
  { name: "Cyan", value: "#00FFFF", textColor: "#000000" },
  { name: "Pink", value: "#FF69B4", textColor: "#000000" },
  { name: "Gold", value: "#FFD700", textColor: "#000000" },
  { name: "Silver", value: "#C0C0C0", textColor: "#000000" },
]

const BACKGROUND_COLOR_PRESETS = [
  { name: "Transparent", value: "#00000000", textColor: "#FFFFFF" },
  { name: "Dark", value: "#000000E6", textColor: "#FFFFFF" },
  { name: "Dark Semi", value: "#00000080", textColor: "#FFFFFF" },
  { name: "Light", value: "#FFFFFFE6", textColor: "#000000" },
  { name: "Blue", value: "#0000FF80", textColor: "#FFFFFF" },
  { name: "Red", value: "#FF000080", textColor: "#FFFFFF" },
  { name: "Green", value: "#00FF0080", textColor: "#000000" },
  { name: "Gradient", value: "linear-gradient(135deg, #667eea80, #764ba280)", textColor: "#FFFFFF" },
]

const BORDER_COLOR_PRESETS = [
  { name: "White", value: "#FFFFFF" },
  { name: "Black", value: "#000000" },
  { name: "Red", value: "#FF0000" },
  { name: "Blue", value: "#0000FF" },
  { name: "Gold", value: "#FFD700" },
  { name: "Silver", value: "#C0C0C0" },
  { name: "Neon", value: "#00FFFF" },
  { name: "Hot Pink", value: "#FF69B4" },
]

const SHADOW_COLOR_PRESETS = [
  { name: "Black", value: "#00000080" },
  { name: "Dark", value: "#00000040" },
  { name: "Red Glow", value: "#FF000040" },
  { name: "Blue Glow", value: "#0000FF40" },
  { name: "Green Glow", value: "#00FF0040" },
  { name: "White", value: "#FFFFFF40" },
]

const FONT_FAMILIES = [
  { name: "Arial", value: "Arial, sans-serif" },
  { name: "Helvetica", value: "Helvetica, sans-serif" },
  { name: "Verdana", value: "Verdana, sans-serif" },
  { name: "Georgia", value: "Georgia, serif" },
  { name: "Times", value: "'Times New Roman', serif" },
  { name: "Courier", value: "'Courier New', monospace" },
  { name: "Roboto", value: "'Roboto', sans-serif" },
  { name: "Open Sans", value: "'Open Sans', sans-serif" },
  { name: "Montserrat", value: "'Montserrat', sans-serif" },
  { name: "Poppins", value: "'Poppins', sans-serif" },
]

const CAPTION_TEMPLATES: CaptionTemplate[] = [
  {
    id: "1",
    name: "Professional",
    description: "Clean, readable captions for corporate videos",
    icon: "üéØ",
    category: "professional",
    style: {
      fontFamily: "Arial, sans-serif",
      fontSize: 28,
      fontColor: "#FFFFFF",
      backgroundColor: "#000000E6",
      bold: true,
      italic: false,
      borderWidth: 0,
      borderRadius: 4,
      shadowColor: "#00000080",
      shadowBlur: 4
    }
  },
  {
    id: "2",
    name: "Minimal",
    description: "Simple, unobtrusive captions",
    icon: "‚ú®",
    category: "minimal",
    style: {
      fontFamily: "Helvetica, sans-serif",
      fontSize: 24,
      fontColor: "#FFFFFF",
      backgroundColor: "#00000080",
      bold: false,
      italic: false,
      borderWidth: 0,
      borderRadius: 2,
      shadowColor: "#00000040",
      shadowBlur: 2
    }
  },
  {
    id: "3",
    name: "Creative",
    description: "Bold captions with effects",
    icon: "üé®",
    category: "creative",
    style: {
      fontFamily: "Poppins, sans-serif",
      fontSize: 32,
      fontColor: "#FFFFFF",
      backgroundColor: "#0000FF80",
      bold: true,
      italic: false,
      borderWidth: 2,
      borderColor: "#FFD700",
      borderRadius: 12,
      shadowColor: "#0000FF40",
      shadowBlur: 8
    }
  },
  {
    id: "4",
    name: "Social Media",
    description: "Eye-catching for platforms",
    icon: "üì±",
    category: "casual",
    style: {
      fontFamily: "Montserrat, sans-serif",
      fontSize: 30,
      fontColor: "#FFFFFF",
      backgroundColor: "#000000E6",
      bold: true,
      italic: false,
      borderWidth: 3,
      borderColor: "#FF69B4",
      borderRadius: 20,
      shadowColor: "#FF69B440",
      shadowBlur: 12
    }
  }
]

// Keyboard shortcuts
const KEYBOARD_SHORTCUTS = [
  { key: "Space", action: "Play/Pause video" },
  { key: "‚Üê ‚Üí", action: "Seek ¬±5 seconds" },
  { key: "Ctrl/Cmd + S", action: "Save project" },
  { key: "Ctrl/Cmd + D", action: "Duplicate subtitle" },
  { key: "Ctrl/Cmd + Z", action: "Undo" },
  { key: "Ctrl/Cmd + Shift + Z", action: "Redo" },
  { key: "Enter", action: "Save subtitle edit" },
  { key: "Esc", action: "Cancel edit" }
]

export default function Home() {
  const [file, setFile] = useState<File | null>(null)
  const [videoUrl, setVideoUrl] = useState<string>("")
  const [loading, setLoading] = useState(false)
  const [uploadProgress, setUploadProgress] = useState(0)
  const [videoDuration, setVideoDuration] = useState<number>(0)
  const [videoResolution, setVideoResolution] = useState({ width: 0, height: 0 })
  const [isProcessingComplete, setIsProcessingComplete] = useState(false)
  const [activeSettingsTab, setActiveSettingsTab] = useState<'style' | 'layout' | 'effects' | 'templates' | 'ai' | 'timeline'>('style')
  const [isCaptionPanelOpen, setIsCaptionPanelOpen] = useState(true)
  const [showCustomColorPicker, setShowCustomColorPicker] = useState<null | 'font' | 'bg' | 'border'>(null)
  const [customColor, setCustomColor] = useState<string>("#FFFFFF")
  const [editingSubtitleId, setEditingSubtitleId] = useState<string | null>(null)
  const [timeRange, setTimeRange] = useState({ start: 0, end: 5 })
  const [showAllCaptions, setShowAllCaptions] = useState(false)
  const [isGeneratingAI, setIsGeneratingAI] = useState(false)
  const [projectName, setProjectName] = useState("Untitled Project")
  const [showTimeline, setShowTimeline] = useState(true)
  const [selectedLanguage, setSelectedLanguage] = useState("en")
  const [aiProgress, setAiProgress] = useState(0)
  
  // Subtitle state
  const [subtitles, setSubtitles] = useState<Subtitle[]>([
    { 
      id: "1", 
      text: "Hi everyone, I am Srivindu Kumar and basically what I am going to show you", 
      startTime: 0, 
      endTime: 5 
    },
    { 
      id: "2", 
      text: "Welcome to AI Video Studio Pro - The ultimate caption editor", 
      startTime: 5, 
      endTime: 10 
    },
    { 
      id: "3", 
      text: "This is subtitle number three with full customization", 
      startTime: 10, 
      endTime: 15 
    },
    { 
      id: "4", 
      text: "Thanks for watching! All styles are baked into final video", 
      startTime: 15, 
      endTime: 20 
    },
  ])
  
  const [currentSubtitle, setCurrentSubtitle] = useState<Subtitle | null>(null)
  
  const [themeSettings, setThemeSettings] = useState<ThemeSettings>({
    captions: {
      bold: true,
      italic: false,
      underline: false,
      strikethrough: false,
      fontSize: 32,
      fontColor: '#FFFFFF',
      backgroundColor: '#000000E6',
      backgroundOpacity: 90,
      position: 'bottom',
      textAlign: 'center',
      borderColor: '#0000FF',
      borderWidth: 2,
      borderRadius: 8,
      shadowColor: '#00000080',
      shadowBlur: 4,
      shadowOffsetX: 2,
      shadowOffsetY: 2,
      fontFamily: 'Arial, sans-serif',
      letterSpacing: 0,
      lineHeight: 1.2,
      textTransform: 'none',
      padding: 12,
      margin: 0,
      transition: 'fade',
      animationSpeed: 300,
      maxWidth: 800,
      multiline: true
    },
    video: {
      brightness: 100,
      contrast: 100,
      saturation: 100,
      volume: 100
    }
  })
  
  const videoRef = useRef<HTMLVideoElement>(null)
  const [forceUpdate, setForceUpdate] = useState(0)
  const [showSuccess, setShowSuccess] = useState(false)
  const [showDemoOverlay, setShowDemoOverlay] = useState(true)
  const [showExportOptions, setShowExportOptions] = useState(false)
  const [captionStats, setCaptionStats] = useState({
    totalCharacters: 0,
    totalWords: 0,
    avgDuration: 0,
    readingSpeed: 150,
    estimatedReadTime: 0
  })

  // Calculate caption statistics
  useEffect(() => {
    if (subtitles.length > 0) {
      const totalChars = subtitles.reduce((sum, sub) => sum + sub.text.length, 0)
      const totalWords = subtitles.reduce((sum, sub) => sum + sub.text.split(/\s+/).length, 0)
      const totalDuration = subtitles.reduce((sum, sub) => sum + (sub.endTime - sub.startTime), 0)
      const avgDuration = totalDuration / subtitles.length
      const readTime = totalWords / captionStats.readingSpeed * 60 // Convert to seconds
      
      setCaptionStats({
        totalCharacters: totalChars,
        totalWords: totalWords,
        avgDuration: avgDuration,
        readingSpeed: captionStats.readingSpeed,
        estimatedReadTime: readTime
      })
    }
  }, [subtitles])

  // Extract video metadata when file changes
  useEffect(() => {
    if (file) {
      const url = URL.createObjectURL(file)
      const tempVideo = document.createElement('video')
      tempVideo.src = url
      
      tempVideo.addEventListener('loadedmetadata', () => {
        setVideoDuration(tempVideo.duration)
        setVideoResolution({
          width: tempVideo.videoWidth,
          height: tempVideo.videoHeight
        })
        URL.revokeObjectURL(url)
        
        if (videoRef.current) {
          setTimeout(() => {
            videoRef.current?.play().catch(console.error)
          }, 500)
        }
      })
    }
  }, [file])

  // Handle video time updates for subtitle synchronization
  useEffect(() => {
    const video = videoRef.current
    if (!video) return

    const handleTimeUpdate = () => {
      const currentTime = video.currentTime
      const activeSubtitle = subtitles.find(
        sub => currentTime >= sub.startTime && currentTime <= sub.endTime
      )
      
      if (activeSubtitle?.id !== currentSubtitle?.id) {
        setCurrentSubtitle(activeSubtitle || null)
      }
    }

    video.addEventListener("timeupdate", handleTimeUpdate)
    video.addEventListener("play", handleTimeUpdate)
    video.addEventListener("pause", handleTimeUpdate)
    
    return () => {
      video.removeEventListener("timeupdate", handleTimeUpdate)
      video.removeEventListener("play", handleTimeUpdate)
      video.removeEventListener("pause", handleTimeUpdate)
    }
  }, [subtitles, currentSubtitle])

  // Force update when caption settings change
  useEffect(() => {
    setForceUpdate(prev => prev + 1)
  }, [themeSettings.captions])

  // Keyboard shortcuts
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      const video = videoRef.current
      if (!video) return

      switch (e.key) {
        case ' ':
          e.preventDefault()
          if (video.paused) {
            video.play()
          } else {
            video.pause()
          }
          break
        case 'ArrowLeft':
          e.preventDefault()
          video.currentTime = Math.max(0, video.currentTime - 5)
          break
        case 'ArrowRight':
          e.preventDefault()
          video.currentTime = Math.min(video.duration, video.currentTime + 5)
          break
        case 's':
        case 'S':
          if (e.ctrlKey || e.metaKey) {
            e.preventDefault()
            saveProject()
          }
          break
        case 'd':
        case 'D':
          if (e.ctrlKey || e.metaKey) {
            e.preventDefault()
            if (currentSubtitle) {
              duplicateSubtitle(currentSubtitle.id)
            }
          }
          break
        case 'Escape':
          if (editingSubtitleId) {
            setEditingSubtitleId(null)
          }
          break
      }
    }

    window.addEventListener('keydown', handleKeyDown)
    return () => window.removeEventListener('keydown', handleKeyDown)
  }, [currentSubtitle, editingSubtitleId])

  const generate = async () => {
    if (!file) {
      alert("Please upload a video")
      return
    }

    const form = new FormData()
    form.append("video", file)
    
    const processingData = {
      themeSettings: {
        captions: {
          ...themeSettings.captions,
          bold: themeSettings.captions.bold,
          italic: themeSettings.captions.italic,
          underline: themeSettings.captions.underline,
          strikethrough: themeSettings.captions.strikethrough,
          fontSize: themeSettings.captions.fontSize,
          fontColor: themeSettings.captions.fontColor,
          backgroundColor: themeSettings.captions.backgroundColor,
          backgroundOpacity: themeSettings.captions.backgroundOpacity,
          position: themeSettings.captions.position,
          textAlign: themeSettings.captions.textAlign,
          borderColor: themeSettings.captions.borderColor,
          borderWidth: themeSettings.captions.borderWidth,
          borderRadius: themeSettings.captions.borderRadius,
          shadowColor: themeSettings.captions.shadowColor,
          shadowBlur: themeSettings.captions.shadowBlur,
          shadowOffsetX: themeSettings.captions.shadowOffsetX,
          shadowOffsetY: themeSettings.captions.shadowOffsetY,
          fontFamily: themeSettings.captions.fontFamily,
          letterSpacing: themeSettings.captions.letterSpacing,
          lineHeight: themeSettings.captions.lineHeight,
          textTransform: themeSettings.captions.textTransform,
          padding: themeSettings.captions.padding,
          margin: themeSettings.captions.margin,
          transition: themeSettings.captions.transition,
          animationSpeed: themeSettings.captions.animationSpeed,
          maxWidth: themeSettings.captions.maxWidth,
          multiline: themeSettings.captions.multiline
        },
        video: {
          brightness: themeSettings.video.brightness,
          contrast: themeSettings.video.contrast,
          saturation: themeSettings.video.saturation,
          volume: themeSettings.video.volume
        }
      },
      subtitles: subtitles.map(sub => ({
        id: sub.id,
        text: sub.text,
        startTime: sub.startTime,
        endTime: sub.endTime
      }))
    }
    
    form.append("processingData", JSON.stringify(processingData))

    setLoading(true)
    setIsProcessingComplete(false)
    setUploadProgress(0)

    const progressInterval = setInterval(() => {
      setUploadProgress(prev => {
        if (prev >= 90) {
          clearInterval(progressInterval)
          return prev
        }
        return prev + Math.random() * 15
      })
    }, 500)

    try {
      const res = await fetch("http://localhost:8000/process", {
        method: "POST",
        body: form
      })

      clearInterval(progressInterval)
      
      if (!res.ok) {
        throw new Error("Backend error")
      }

      const result = await res.json()
      
      if (result.status === "success") {
        const timestamp = new Date().getTime()
        setVideoUrl(`http://localhost:8000/output-video?t=${timestamp}`)
        setUploadProgress(100)
        setIsProcessingComplete(true)
        setShowSuccess(true)
        
        setTimeout(() => setShowSuccess(false), 3000)
      } else {
        throw new Error(result.message || "Processing failed")
      }
      
      setTimeout(() => setUploadProgress(0), 2000)

    } catch (error) {
      alert(`Error processing video: ${error}`)
    } finally {
      setTimeout(() => setLoading(false), 500)
    }
  }

  const handleDownload = () => {
    if (videoUrl) {
      const a = document.createElement('a')
      a.href = videoUrl
      a.download = `enhanced-video-${Date.now()}.mp4`
      document.body.appendChild(a)
      a.click()
      document.body.removeChild(a)
    }
  }

  const updateCaptionSetting = (key: keyof ThemeSettings['captions'], value: any) => {
    setThemeSettings(prev => ({
      ...prev,
      captions: {
        ...prev.captions,
        [key]: value
      }
    }))
  }

  const updateVideoSetting = (key: keyof ThemeSettings['video'], value: number) => {
    setThemeSettings(prev => ({
      ...prev,
      video: {
        ...prev.video,
        [key]: value
      }
    }))
  }

  const updateSubtitleText = (id: string, text: string) => {
    setSubtitles(prev => prev.map(sub => 
      sub.id === id ? { ...sub, text } : sub
    ))
  }

  const updateSubtitleTime = (id: string, type: 'start' | 'end', value: number) => {
    setSubtitles(prev => prev.map(sub => 
      sub.id === id ? { 
        ...sub, 
        [type === 'start' ? 'startTime' : 'endTime']: value 
      } : sub
    ))
  }

  const formatDuration = (seconds: number) => {
    const mins = Math.floor(seconds / 60)
    const secs = Math.floor(seconds % 60)
    return `${mins}:${secs.toString().padStart(2, '0')}`
  }

  const getVideoFilterStyle = () => {
    return {
      filter: `brightness(${themeSettings.video.brightness}%) contrast(${themeSettings.video.contrast}%) saturate(${themeSettings.video.saturation}%)`
    }
  }

  const getVideoSrc = () => {
    if (videoUrl) {
      return videoUrl
    } else if (file) {
      return URL.createObjectURL(file)
    }
    return undefined
  }

  const getSubtitlePositionStyle = () => {
    switch (themeSettings.captions.position) {
      case 'top':
        return { top: '10%', transform: 'translateY(0)' }
      case 'middle':
        return { top: '50%', transform: 'translateY(-50%)' }
      case 'bottom':
        return { top: '85%', transform: 'translateY(0)' }
      default:
        return { top: '85%', transform: 'translateY(0)' }
    }
  }

  const getCaptionStyle = () => {
    const style: React.CSSProperties = {
      fontFamily: themeSettings.captions.fontFamily,
      fontSize: `${themeSettings.captions.fontSize}px`,
      color: themeSettings.captions.fontColor,
      backgroundColor: themeSettings.captions.backgroundColor,
      opacity: themeSettings.captions.backgroundOpacity / 100,
      textAlign: themeSettings.captions.textAlign as any,
      fontWeight: themeSettings.captions.bold ? 'bold' : 'normal',
      fontStyle: themeSettings.captions.italic ? 'italic' : 'normal',
      textDecoration: [
        themeSettings.captions.underline ? 'underline' : '',
        themeSettings.captions.strikethrough ? 'line-through' : ''
      ].filter(Boolean).join(' ') || 'none',
      textTransform: themeSettings.captions.textTransform,
      letterSpacing: `${themeSettings.captions.letterSpacing}px`,
      lineHeight: themeSettings.captions.lineHeight,
      border: `${themeSettings.captions.borderWidth}px solid ${themeSettings.captions.borderColor}`,
      borderRadius: `${themeSettings.captions.borderRadius}px`,
      boxShadow: `${themeSettings.captions.shadowOffsetX}px ${themeSettings.captions.shadowOffsetY}px ${themeSettings.captions.shadowBlur}px ${themeSettings.captions.shadowColor}`,
      padding: `${themeSettings.captions.padding}px`,
      margin: `${themeSettings.captions.margin}px`,
      textShadow: '2px 2px 8px rgba(0,0,0,0.8)',
      wordBreak: 'break-word',
      overflowWrap: 'break-word',
      backdropFilter: 'blur(4px)',
      maxWidth: `${themeSettings.captions.maxWidth}px`,
      transition: `all ${themeSettings.captions.animationSpeed}ms ease-in-out`,
    }

    // Add transition effects
    if (themeSettings.captions.transition === 'fade') {
      style.animation = `fadeIn ${themeSettings.captions.animationSpeed}ms ease-in-out`
    } else if (themeSettings.captions.transition === 'slide') {
      style.animation = `slideUp ${themeSettings.captions.animationSpeed}ms ease-in-out`
    }

    return style
  }

  const handleColorSelect = (type: 'font' | 'bg' | 'border', color: string) => {
    switch (type) {
      case 'font':
        updateCaptionSetting('fontColor', color)
        break
      case 'bg':
        updateCaptionSetting('backgroundColor', color)
        break
      case 'border':
        updateCaptionSetting('borderColor', color)
        break
    }
  }

  const addNewSubtitle = () => {
    const newId = (subtitles.length + 1).toString()
    const lastSubtitle = subtitles[subtitles.length - 1]
    const newSubtitle: Subtitle = {
      id: newId,
      text: "New subtitle text",
      startTime: lastSubtitle ? lastSubtitle.endTime : 0,
      endTime: lastSubtitle ? lastSubtitle.endTime + 5 : 5
    }
    setSubtitles([...subtitles, newSubtitle])
    setEditingSubtitleId(newId)
    setTimeRange({ start: newSubtitle.startTime, end: newSubtitle.endTime })
  }

  const deleteSubtitle = (id: string) => {
    setSubtitles(subtitles.filter(sub => sub.id !== id))
    if (currentSubtitle?.id === id) {
      setCurrentSubtitle(null)
    }
    if (editingSubtitleId === id) {
      setEditingSubtitleId(null)
    }
  }

  const duplicateSubtitle = (id: string) => {
    const subtitleToDuplicate = subtitles.find(sub => sub.id === id)
    if (subtitleToDuplicate) {
      const newId = (subtitles.length + 1).toString()
      const duplicatedSubtitle = {
        ...subtitleToDuplicate,
        id: newId,
        startTime: subtitleToDuplicate.endTime,
        endTime: subtitleToDuplicate.endTime + (subtitleToDuplicate.endTime - subtitleToDuplicate.startTime)
      }
      setSubtitles([...subtitles, duplicatedSubtitle])
    }
  }

  const editTimeRange = (id: string) => {
    const subtitle = subtitles.find(sub => sub.id === id)
    if (subtitle) {
      setEditingSubtitleId(id)
      setTimeRange({ start: subtitle.startTime, end: subtitle.endTime })
    }
  }

  const saveTimeRange = () => {
    if (editingSubtitleId) {
      updateSubtitleTime(editingSubtitleId, 'start', timeRange.start)
      updateSubtitleTime(editingSubtitleId, 'end', timeRange.end)
      setEditingSubtitleId(null)
    }
  }

  const cancelTimeRangeEdit = () => {
    setEditingSubtitleId(null)
  }

  const applyStyleToAll = () => {
    setSubtitles(prev => prev.map(sub => ({
      ...sub,
      style: { ...themeSettings.captions }
    })))
    alert("Style applied to all captions!")
  }

  const applyTemplate = (template: CaptionTemplate) => {
    Object.entries(template.style).forEach(([key, value]) => {
      updateCaptionSetting(key as keyof ThemeSettings['captions'], value)
    })
  }

  const generateAICaptions = async () => {
    if (!file) {
      alert("Please upload a video first")
      return
    }

    setIsGeneratingAI(true)
    setAiProgress(0)

    // Simulate AI processing
    const interval = setInterval(() => {
      setAiProgress(prev => {
        if (prev >= 100) {
          clearInterval(interval)
          setIsGeneratingAI(false)
          
          // Add sample AI-generated captions
          const newSubtitles: Subtitle[] = [
            {
              id: "ai1",
              text: "[AI] Welcome to our tutorial video",
              startTime: 0,
              endTime: 4,
              isAutoGenerated: true,
              confidence: 0.95
            },
            {
              id: "ai2",
              text: "[AI] In this video, we'll learn about advanced caption editing",
              startTime: 4,
              endTime: 8,
              isAutoGenerated: true,
              confidence: 0.92
            },
            {
              id: "ai3",
              text: "[AI] All styles are baked directly into the final output",
              startTime: 8,
              endTime: 12,
              isAutoGenerated: true,
              confidence: 0.88
            }
          ]

          setSubtitles(prev => [...newSubtitles, ...prev])
          return 100
        }
        return prev + Math.random() * 15
      })
    }, 300)
  }

  const exportSubtitles = (format: 'srt' | 'vtt' | 'txt') => {
    let content = ''
    
    if (format === 'srt') {
      subtitles.forEach((sub, index) => {
        content += `${index + 1}\n`
        content += `${formatDuration(sub.startTime)} --> ${formatDuration(sub.endTime)}\n`
        content += `${sub.text}\n\n`
      })
    } else if (format === 'vtt') {
      content = 'WEBVTT\n\n'
      subtitles.forEach((sub, index) => {
        content += `${index + 1}\n`
        content += `${formatDuration(sub.startTime)} --> ${formatDuration(sub.endTime)}\n`
        content += `${sub.text}\n\n`
      })
    } else if (format === 'txt') {
      subtitles.forEach((sub, index) => {
        content += `[${formatDuration(sub.startTime)} - ${formatDuration(sub.endTime)}]\n`
        content += `${sub.text}\n\n`
      })
    }

    const blob = new Blob([content], { type: 'text/plain' })
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = `subtitles-${Date.now()}.${format}`
    document.body.appendChild(a)
    a.click()
    document.body.removeChild(a)
    URL.revokeObjectURL(url)
  }

  const importSubtitles = (event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0]
    if (!file) return

    const reader = new FileReader()
    reader.onload = (e) => {
      const content = e.target?.result as string
      // Basic parsing logic - can be enhanced for different formats
      const lines = content.split('\n')
      const newSubtitles: Subtitle[] = []
      let currentSubtitle: Partial<Subtitle> = {}
      
      lines.forEach((line, index) => {
        if (line.includes('-->') || line.includes('-')) {
          const times = line.split(/--?>|-/).map(t => t.trim())
          if (times.length >= 2) {
            // Parse time format
            const start = parseTime(times[0])
            const end = parseTime(times[1])
            if (currentSubtitle.id) {
              newSubtitles.push(currentSubtitle as Subtitle)
            }
            currentSubtitle = {
              id: (newSubtitles.length + 1).toString(),
              startTime: start,
              endTime: end
            }
          }
        } else if (line.trim() && !/^\d+$/.test(line.trim())) {
          currentSubtitle.text = (currentSubtitle.text || '') + line.trim() + ' '
        }
      })

      if (currentSubtitle.id) {
        newSubtitles.push(currentSubtitle as Subtitle)
      }

      setSubtitles(prev => [...prev, ...newSubtitles])
    }
    reader.readAsText(file)
  }

  const parseTime = (timeStr: string): number => {
    // Simple time parsing - can be enhanced
    const parts = timeStr.split(':').map(parseFloat)
    if (parts.length === 3) {
      return parts[0] * 3600 + parts[1] * 60 + parts[2]
    } else if (parts.length === 2) {
      return parts[0] * 60 + parts[1]
    }
    return parseFloat(timeStr) || 0
  }

  const saveProject = () => {
    const project = {
      name: projectName,
      date: new Date().toISOString(),
      subtitles,
      themeSettings,
      videoFile: file?.name
    }
    
    const blob = new Blob([JSON.stringify(project, null, 2)], { type: 'application/json' })
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = `${projectName.replace(/\s+/g, '-')}.captionpro`
    document.body.appendChild(a)
    a.click()
    document.body.removeChild(a)
    URL.revokeObjectURL(url)
    
    setShowSuccess(true)
    setTimeout(() => setShowSuccess(false), 2000)
  }

  const autoSyncSubtitles = () => {
    const newSubtitles = [...subtitles]
    // Simple auto-sync: adjust timings based on text length
    newSubtitles.forEach(sub => {
      const wordCount = sub.text.split(/\s+/).length
      const idealDuration = Math.max(2, Math.min(5, wordCount * 0.4)) // 0.4 seconds per word
      const currentDuration = sub.endTime - sub.startTime
      const adjustment = idealDuration - currentDuration
      
      if (Math.abs(adjustment) > 0.5) {
        sub.endTime = sub.startTime + idealDuration
      }
    })
    
    // Adjust overlapping subtitles
    for (let i = 1; i < newSubtitles.length; i++) {
      if (newSubtitles[i].startTime < newSubtitles[i-1].endTime) {
        newSubtitles[i].startTime = newSubtitles[i-1].endTime + 0.1
        newSubtitles[i].endTime = newSubtitles[i].startTime + (newSubtitles[i].endTime - newSubtitles[i].startTime)
      }
    }
    
    setSubtitles(newSubtitles)
    alert("Subtitles auto-synced based on text length!")
  }

  const resetToDefaults = () => {
    setThemeSettings({
      captions: {
        bold: true,
        italic: false,
        underline: false,
        strikethrough: false,
        fontSize: 32,
        fontColor: '#FFFFFF',
        backgroundColor: '#000000E6',
        backgroundOpacity: 90,
        position: 'bottom',
        textAlign: 'center',
        borderColor: '#0000FF',
        borderWidth: 2,
        borderRadius: 8,
        shadowColor: '#00000080',
        shadowBlur: 4,
        shadowOffsetX: 2,
        shadowOffsetY: 2,
        fontFamily: 'Arial, sans-serif',
        letterSpacing: 0,
        lineHeight: 1.2,
        textTransform: 'none',
        padding: 12,
        margin: 0,
        transition: 'fade',
        animationSpeed: 300,
        maxWidth: 800,
        multiline: true
      },
      video: {
        brightness: 100,
        contrast: 100,
        saturation: 100,
        volume: 100
      }
    })
  }

  return (
    <main className="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 relative overflow-hidden">
      {/* Animated background elements */}
      <div className="fixed inset-0 -z-10">
        <div className="absolute top-0 left-1/4 w-96 h-96 bg-blue-500/5 rounded-full blur-3xl animate-float" />
        <div className="absolute bottom-0 right-1/4 w-96 h-96 bg-purple-500/5 rounded-full blur-3xl animate-float" style={{ animationDelay: '1s' }} />
        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full bg-radial-gradient(at 50% 50%, rgba(59, 130, 246, 0.1) 0%, transparent 50%)" />
      </div>

      {/* Success notification */}
      {showSuccess && (
        <div className="fixed top-6 right-6 z-50 animate-slide-in-right">
          <div className="bg-gradient-to-r from-green-500/20 to-emerald-500/20 backdrop-blur-lg border border-green-500/30 rounded-xl p-4 flex items-center gap-3 shadow-2xl">
            <div className="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center animate-bounce-subtle">
              <Check className="w-5 h-5 text-green-400" />
            </div>
            <div>
              <p className="font-semibold text-white">Processing Complete!</p>
              <p className="text-sm text-green-300">Video with captions is ready</p>
            </div>
          </div>
        </div>
      )}

      {/* Enhanced Header with Project Name */}
      <header className="border-b border-gray-700/50 bg-gray-900/80 backdrop-blur-lg sticky top-0 z-40 animate-slide-down">
        <div className="container mx-auto px-8 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3 group cursor-pointer">
              <div className="p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl shadow-lg hover-lift transition-all duration-300 group-hover:shadow-blue-500/20 group-hover:scale-105">
                <Video className="w-8 h-8 text-white animate-pulse-subtle" />
              </div>
              <div>
                <div className="flex items-center gap-2">
                  <input
                    type="text"
                    value={projectName}
                    onChange={(e) => setProjectName(e.target.value)}
                    className="text-2xl font-bold text-white bg-transparent border-none outline-none hover:bg-gray-800/50 px-2 py-1 rounded-lg transition-colors"
                  />
                  <button
                    onClick={saveProject}
                    className="p-1 hover:bg-blue-500/20 rounded-lg transition-colors"
                    title="Save Project"
                  >
                    <Save className="w-4 h-4 text-blue-400" />
                  </button>
                </div>
                <p className="text-sm text-gray-400 flex items-center gap-2">
                  <span className="flex items-center gap-1">
                    <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse" />
                    Final output captions with styles ‚Ä¢ {subtitles.length} captions
                  </span>
                </p>
              </div>
            </div>
            <div className="flex items-center gap-4">
              {/* Quick Stats */}
              <div className="hidden md:flex items-center gap-4">
                <div className="flex items-center gap-2 px-3 py-1.5 bg-gray-800/50 rounded-lg">
                  <Type className="w-4 h-4 text-blue-400" />
                  <span className="text-sm text-gray-300">{captionStats.totalWords} words</span>
                </div>
                <div className="flex items-center gap-2 px-3 py-1.5 bg-gray-800/50 rounded-lg">
                  <ClockIcon className="w-4 h-4 text-green-400" />
                  <span className="text-sm text-gray-300">{formatDuration(captionStats.estimatedReadTime)}</span>
                </div>
              </div>
              
              <button
                onClick={resetToDefaults}
                className="flex items-center gap-2 px-4 py-2 bg-gray-800/50 hover:bg-gray-700/50 rounded-xl transition-all duration-300 border border-gray-700/50 hover:border-blue-500/30 hover-lift"
              >
                <RotateCw className="w-4 h-4 text-gray-400" />
                <span className="text-sm font-medium text-white hidden md:inline">Reset</span>
              </button>
              
              <button className="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 flex items-center justify-center text-white font-bold cursor-pointer hover-lift hover:scale-105 transition-transform shadow-lg hover:shadow-xl animate-bounce-subtle">
                <span className="relative">
                  U
                  <div className="absolute -inset-1 bg-gradient-to-r from-blue-500/30 to-pink-500/30 blur-sm rounded-full -z-10" />
                </span>
              </button>
            </div>
          </div>
        </div>
      </header>

      <div className="container mx-auto px-8 py-8 animate-fade-in">
        <div className="grid grid-cols-12 gap-8">
          {/* Enhanced Left Panel - Caption Customization */}
          <div className={`col-span-4 transition-all duration-500 ${isCaptionPanelOpen ? 'opacity-100 translate-x-0' : 'opacity-0 -translate-x-full absolute'}`}>
            <div className="bg-gray-800/50 backdrop-blur-sm rounded-2xl border border-gray-700/50 p-6 hover-lift transition-all duration-300 hover:border-purple-500/30">
              <div className="flex items-center justify-between mb-6">
                <div className="flex items-center gap-3">
                  <div className="relative">
                    <div className="p-2 bg-purple-500/20 rounded-lg">
                      <Layers className="w-5 h-5 text-purple-400" />
                    </div>
                    <div className="absolute -top-1 -right-1 w-3 h-3 bg-purple-500 rounded-full animate-pulse" style={{ animationDelay: '0.3s' }} />
                  </div>
                  <div>
                    <h2 className="text-lg font-semibold text-white">Caption Customization</h2>
                    <p className="text-sm text-gray-400">Styles baked into final video output</p>
                  </div>
                </div>
                <button
                  onClick={() => setIsCaptionPanelOpen(false)}
                  className="p-2 hover:bg-gray-700/50 rounded-lg transition-colors"
                >
                  <X className="w-4 h-4 text-gray-400" />
                </button>
              </div>

              {/* Enhanced Settings Tabs */}
              <div className="flex gap-1 mb-6 bg-gray-700/30 rounded-xl p-1 overflow-x-auto">
                <button
                  onClick={() => setActiveSettingsTab('style')}
                  className={`flex-shrink-0 py-2 px-3 rounded-lg text-sm font-medium transition-all ${activeSettingsTab === 'style' ? 'bg-gradient-to-r from-blue-500/20 to-purple-500/20 text-blue-400 border border-blue-500/30' : 'text-gray-400 hover:text-white'}`}
                >
                  Style
                </button>
                <button
                  onClick={() => setActiveSettingsTab('layout')}
                  className={`flex-shrink-0 py-2 px-3 rounded-lg text-sm font-medium transition-all ${activeSettingsTab === 'layout' ? 'bg-gradient-to-r from-blue-500/20 to-purple-500/20 text-blue-400 border border-blue-500/30' : 'text-gray-400 hover:text-white'}`}
                >
                  Layout
                </button>
                <button
                  onClick={() => setActiveSettingsTab('effects')}
                  className={`flex-shrink-0 py-2 px-3 rounded-lg text-sm font-medium transition-all ${activeSettingsTab === 'effects' ? 'bg-gradient-to-r from-blue-500/20 to-purple-500/20 text-blue-400 border border-blue-500/30' : 'text-gray-400 hover:text-white'}`}
                >
                  Effects
                </button>
                <button
                  onClick={() => setActiveSettingsTab('templates')}
                  className={`flex-shrink-0 py-2 px-3 rounded-lg text-sm font-medium transition-all ${activeSettingsTab === 'templates' ? 'bg-gradient-to-r from-blue-500/20 to-purple-500/20 text-blue-400 border border-blue-500/30' : 'text-gray-400 hover:text-white'}`}
                >
                  Templates
                </button>
                <button
                  onClick={() => setActiveSettingsTab('ai')}
                  className={`flex-shrink-0 py-2 px-3 rounded-lg text-sm font-medium transition-all ${activeSettingsTab === 'ai' ? 'bg-gradient-to-r from-blue-500/20 to-purple-500/20 text-blue-400 border border-blue-500/30' : 'text-gray-400 hover:text-white'}`}
                >
                  AI Tools
                </button>
                <button
                  onClick={() => setActiveSettingsTab('timeline')}
                  className={`flex-shrink-0 py-2 px-3 rounded-lg text-sm font-medium transition-all ${activeSettingsTab === 'timeline' ? 'bg-gradient-to-r from-blue-500/20 to-purple-500/20 text-blue-400 border border-blue-500/30' : 'text-gray-400 hover:text-white'}`}
                >
                  Timeline
                </button>
              </div>

              <div className="space-y-6 max-h-[calc(100vh-300px)] overflow-y-auto pr-2 scrollbar-thin">
                
                {/* Text Style Tab */}
                {activeSettingsTab === 'style' && (
                  <div className="space-y-6">
                    {/* Text Formatting */}
                    <div className="space-y-3">
                      <label className="text-sm font-medium text-white">Text Formatting</label>
                      <div className="grid grid-cols-2 gap-2">
                        <button
                          onClick={() => updateCaptionSetting('bold', !themeSettings.captions.bold)}
                          className={`py-2.5 rounded-lg flex items-center justify-center gap-2 transition-all hover-lift ${themeSettings.captions.bold ? 'bg-blue-500/20 border border-blue-500/30 text-blue-400 shadow-lg shadow-blue-500/10' : 'bg-gray-700/50 hover:bg-gray-700 text-gray-400 hover:text-white'}`}
                        >
                          <Bold className="w-4 h-4" />
                          Bold
                          {themeSettings.captions.bold && <Check className="w-3 h-3 animate-enter" />}
                        </button>
                        <button
                          onClick={() => updateCaptionSetting('italic', !themeSettings.captions.italic)}
                          className={`py-2.5 rounded-lg flex items-center justify-center gap-2 transition-all hover-lift ${themeSettings.captions.italic ? 'bg-purple-500/20 border border-purple-500/30 text-purple-400 shadow-lg shadow-purple-500/10' : 'bg-gray-700/50 hover:bg-gray-700 text-gray-400 hover:text-white'}`}
                        >
                          <Italic className="w-4 h-4" />
                          Italic
                          {themeSettings.captions.italic && <Check className="w-3 h-3 animate-enter" />}
                        </button>
                        <button
                          onClick={() => updateCaptionSetting('underline', !themeSettings.captions.underline)}
                          className={`py-2.5 rounded-lg flex items-center justify-center gap-2 transition-all hover-lift ${themeSettings.captions.underline ? 'bg-green-500/20 border border-green-500/30 text-green-400 shadow-lg shadow-green-500/10' : 'bg-gray-700/50 hover:bg-gray-700 text-gray-400 hover:text-white'}`}
                        >
                          <Underline className="w-4 h-4" />
                          Underline
                          {themeSettings.captions.underline && <Check className="w-3 h-3 animate-enter" />}
                        </button>
                        <button
                          onClick={() => updateCaptionSetting('strikethrough', !themeSettings.captions.strikethrough)}
                          className={`py-2.5 rounded-lg flex items-center justify-center gap-2 transition-all hover-lift ${themeSettings.captions.strikethrough ? 'bg-red-500/20 border border-red-500/30 text-red-400 shadow-lg shadow-red-500/10' : 'bg-gray-700/50 hover:bg-gray-700 text-gray-400 hover:text-white'}`}
                        >
                          <Strikethrough className="w-4 h-4" />
                          Strike
                          {themeSettings.captions.strikethrough && <Check className="w-3 h-3 animate-enter" />}
                        </button>
                      </div>
                    </div>

                    {/* Font Size & Family */}
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <div className="flex justify-between">
                          <label className="text-sm font-medium text-white">Font Size</label>
                          <span className="text-sm text-gray-400">{themeSettings.captions.fontSize}px</span>
                        </div>
                        <input
                          type="range"
                          min="12"
                          max="72"
                          value={themeSettings.captions.fontSize}
                          onChange={(e) => updateCaptionSetting('fontSize', parseInt(e.target.value))}
                          className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer progress-gradient [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:h-5 [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-500 [&::-webkit-slider-thumb]:shadow-lg"
                        />
                      </div>

                      <div className="space-y-2">
                        <label className="text-sm font-medium text-white">Font Family</label>
                        <select
                          value={themeSettings.captions.fontFamily}
                          onChange={(e) => updateCaptionSetting('fontFamily', e.target.value)}
                          className="w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500/50 transition-all"
                        >
                          {FONT_FAMILIES.map(font => (
                            <option key={font.value} value={font.value}>{font.name}</option>
                          ))}
                        </select>
                      </div>
                    </div>

                    {/* Text Color */}
                    <div className="space-y-3">
                      <div className="flex justify-between items-center">
                        <label className="text-sm font-medium text-white">Text Color</label>
                        <button
                          onClick={() => setShowCustomColorPicker(showCustomColorPicker === 'font' ? null : 'font')}
                          className="p-1 hover:bg-gray-700/50 rounded-lg transition-colors"
                        >
                          <Palette className="w-4 h-4 text-blue-400" />
                        </button>
                      </div>
                      {showCustomColorPicker === 'font' && (
                        <div className="mb-3 animate-slide-up">
                          <input
                            type="color"
                            value={customColor}
                            onChange={(e) => {
                              setCustomColor(e.target.value)
                              updateCaptionSetting('fontColor', e.target.value)
                            }}
                            className="w-full h-10 rounded-lg cursor-pointer"
                          />
                        </div>
                      )}
                      <div className="grid grid-cols-6 gap-2">
                        {FONT_COLOR_PRESETS.slice(0, 6).map((color) => (
                          <button
                            key={color.value}
                            onClick={() => handleColorSelect('font', color.value)}
                            className={`relative w-full h-8 rounded-lg border-2 transition-all hover-lift ${themeSettings.captions.fontColor === color.value ? 'border-white scale-105 shadow-lg shadow-white/20' : 'border-gray-600 hover:border-gray-500'}`}
                            style={{ backgroundColor: color.value }}
                            title={color.name}
                          >
                            {themeSettings.captions.fontColor === color.value && (
                              <div className="absolute -top-1 -right-1 w-5 h-5 rounded-full bg-white flex items-center justify-center animate-enter shadow-md">
                                <Check className="w-3 h-3 text-black" />
                              </div>
                            )}
                          </button>
                        ))}
                      </div>
                    </div>

                    {/* Text Transform & Spacing */}
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <label className="text-sm font-medium text-white">Text Transform</label>
                        <div className="grid grid-cols-2 gap-2">
                          {(['none', 'uppercase', 'lowercase', 'capitalize'] as const).map(transform => (
                            <button
                              key={transform}
                              onClick={() => updateCaptionSetting('textTransform', transform)}
                              className={`py-2 rounded-lg text-sm transition-all hover-lift ${themeSettings.captions.textTransform === transform ? 'bg-blue-500/20 border border-blue-500/30 text-blue-400' : 'bg-gray-700/50 hover:bg-gray-700 text-gray-400 hover:text-white'}`}
                            >
                              {transform.charAt(0).toUpperCase() + transform.slice(1)}
                            </button>
                          ))}
                        </div>
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <div className="flex justify-between">
                            <label className="text-sm font-medium text-white">Letter Spacing</label>
                            <span className="text-sm text-gray-400">{themeSettings.captions.letterSpacing}px</span>
                          </div>
                          <input
                            type="range"
                            min="-2"
                            max="10"
                            step="0.5"
                            value={themeSettings.captions.letterSpacing}
                            onChange={(e) => updateCaptionSetting('letterSpacing', parseFloat(e.target.value))}
                            className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer progress-gradient"
                          />
                        </div>
                        <div className="space-y-2">
                          <div className="flex justify-between">
                            <label className="text-sm font-medium text-white">Line Height</label>
                            <span className="text-sm text-gray-400">{themeSettings.captions.lineHeight.toFixed(1)}</span>
                          </div>
                          <input
                            type="range"
                            min="0.8"
                            max="2.5"
                            step="0.1"
                            value={themeSettings.captions.lineHeight}
                            onChange={(e) => updateCaptionSetting('lineHeight', parseFloat(e.target.value))}
                            className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer progress-gradient"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {/* Layout Tab */}
                {activeSettingsTab === 'layout' && (
                  <div className="space-y-6">
                    {/* Background Settings */}
                    <div className="space-y-3">
                      <div className="flex justify-between items-center">
                        <label className="text-sm font-medium text-white">Background</label>
                        <button
                          onClick={() => setShowCustomColorPicker(showCustomColorPicker === 'bg' ? null : 'bg')}
                          className="p-1 hover:bg-gray-700/50 rounded-lg transition-colors"
                        >
                          <PaintBucket className="w-4 h-4 text-blue-400" />
                        </button>
                      </div>
                      {showCustomColorPicker === 'bg' && (
                        <div className="mb-3 animate-slide-up">
                          <input
                            type="color"
                            value={customColor}
                            onChange={(e) => {
                              setCustomColor(e.target.value)
                              updateCaptionSetting('backgroundColor', e.target.value)
                            }}
                            className="w-full h-10 rounded-lg cursor-pointer"
                          />
                        </div>
                      )}
                      <div className="grid grid-cols-4 gap-2">
                        {BACKGROUND_COLOR_PRESETS.map((bg) => (
                          <button
                            key={bg.value}
                            onClick={() => handleColorSelect('bg', bg.value)}
                            className={`relative w-full h-8 rounded-lg border-2 transition-all hover-lift ${themeSettings.captions.backgroundColor === bg.value ? 'border-white scale-105 shadow-lg shadow-white/20' : 'border-gray-600 hover:border-gray-500'}`}
                            style={{ 
                              background: bg.value.startsWith('linear-gradient') ? bg.value : bg.value,
                              backgroundColor: !bg.value.startsWith('linear-gradient') ? bg.value : undefined
                            }}
                            title={bg.name}
                          >
                            {themeSettings.captions.backgroundColor === bg.value && (
                              <div className="absolute -top-1 -right-1 w-5 h-5 rounded-full bg-white flex items-center justify-center animate-enter shadow-md">
                                <Check className="w-3 h-3 text-black" />
                              </div>
                            )}
                          </button>
                        ))}
                      </div>

                      <div className="space-y-2">
                        <div className="flex justify-between">
                          <label className="text-sm font-medium text-white">Background Opacity</label>
                          <span className="text-sm text-gray-400">{themeSettings.captions.backgroundOpacity}%</span>
                        </div>
                        <input
                          type="range"
                          min="0"
                          max="100"
                          value={themeSettings.captions.backgroundOpacity}
                          onChange={(e) => updateCaptionSetting('backgroundOpacity', parseInt(e.target.value))}
                          className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer progress-gradient"
                        />
                      </div>
                    </div>

                    {/* Position & Alignment */}
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <label className="text-sm font-medium text-white">Position</label>
                        <div className="grid grid-cols-3 gap-2">
                          {(['top', 'middle', 'bottom'] as const).map((position) => (
                            <button
                              key={position}
                              onClick={() => updateCaptionSetting('position', position)}
                              className={`py-2 rounded-lg text-sm transition-all hover-lift ${themeSettings.captions.position === position ? 'bg-blue-500/20 border border-blue-500/30 text-blue-400 shadow-lg shadow-blue-500/10' : 'bg-gray-700/50 hover:bg-gray-700 text-gray-400 hover:text-white'}`}
                            >
                              {position.charAt(0).toUpperCase() + position.slice(1)}
                            </button>
                          ))}
                        </div>
                      </div>

                      <div className="space-y-2">
                        <label className="text-sm font-medium text-white">Text Alignment</label>
                        <div className="flex gap-2">
                          {(['left', 'center', 'right'] as const).map((align) => (
                            <button
                              key={align}
                              onClick={() => updateCaptionSetting('textAlign', align)}
                              className={`flex-1 py-2 rounded-lg flex items-center justify-center transition-all hover-lift ${themeSettings.captions.textAlign === align ? 'bg-blue-500/20 border border-blue-500/30 text-blue-400' : 'bg-gray-700/50 hover:bg-gray-700 text-gray-400 hover:text-white'}`}
                            >
                              {align === 'left' && <AlignLeft className="w-4 h-4" />}
                              {align === 'center' && <AlignCenter className="w-4 h-4" />}
                              {align === 'right' && <AlignRight className="w-4 h-4" />}
                            </button>
                          ))}
                        </div>
                      </div>
                    </div>

                    {/* Spacing & Dimensions */}
                    <div className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <div className="flex justify-between">
                            <label className="text-sm font-medium text-white">Padding</label>
                            <span className="text-sm text-gray-400">{themeSettings.captions.padding}px</span>
                          </div>
                          <input
                            type="range"
                            min="0"
                            max="40"
                            value={themeSettings.captions.padding}
                            onChange={(e) => updateCaptionSetting('padding', parseInt(e.target.value))}
                            className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer progress-gradient"
                          />
                        </div>
                        <div className="space-y-2">
                          <div className="flex justify-between">
                            <label className="text-sm font-medium text-white">Max Width</label>
                            <span className="text-sm text-gray-400">{themeSettings.captions.maxWidth}px</span>
                          </div>
                          <input
                            type="range"
                            min="200"
                            max="1200"
                            value={themeSettings.captions.maxWidth}
                            onChange={(e) => updateCaptionSetting('maxWidth', parseInt(e.target.value))}
                            className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer progress-gradient"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {/* Effects Tab */}
                {activeSettingsTab === 'effects' && (
                  <div className="space-y-6">
                    {/* Border Settings */}
                    <div className="space-y-3">
                      <div className="flex justify-between items-center">
                        <label className="text-sm font-medium text-white">Border</label>
                        <div className="flex items-center gap-2">
                          <button
                            onClick={() => setShowCustomColorPicker(showCustomColorPicker === 'border' ? null : 'border')}
                            className="p-1 hover:bg-gray-700/50 rounded-lg transition-colors"
                          >
                            <Palette className="w-4 h-4 text-blue-400" />
                          </button>
                        </div>
                      </div>
                      {showCustomColorPicker === 'border' && (
                        <div className="mb-3 animate-slide-up">
                          <input
                            type="color"
                            value={customColor}
                            onChange={(e) => {
                              setCustomColor(e.target.value)
                              updateCaptionSetting('borderColor', e.target.value)
                            }}
                            className="w-full h-10 rounded-lg cursor-pointer"
                          />
                        </div>
                      )}
                      <div className="grid grid-cols-4 gap-2">
                        {BORDER_COLOR_PRESETS.map((color) => (
                          <button
                            key={color.value}
                            onClick={() => handleColorSelect('border', color.value)}
                            className={`relative w-full h-8 rounded-lg border-2 transition-all hover-lift ${themeSettings.captions.borderColor === color.value ? 'border-white scale-105 shadow-lg shadow-white/20' : 'border-gray-600 hover:border-gray-500'}`}
                            style={{ backgroundColor: color.value }}
                            title={color.name}
                          >
                            {themeSettings.captions.borderColor === color.value && (
                              <div className="absolute -top-1 -right-1 w-5 h-5 rounded-full bg-white flex items-center justify-center animate-enter shadow-md">
                                <Check className="w-3 h-3 text-black" />
                              </div>
                            )}
                          </button>
                        ))}
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <div className="flex justify-between">
                            <label className="text-sm font-medium text-white">Border Width</label>
                            <span className="text-sm text-gray-400">{themeSettings.captions.borderWidth}px</span>
                          </div>
                          <input
                            type="range"
                            min="0"
                            max="10"
                            value={themeSettings.captions.borderWidth}
                            onChange={(e) => updateCaptionSetting('borderWidth', parseInt(e.target.value))}
                            className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer progress-gradient"
                          />
                        </div>
                        <div className="space-y-2">
                          <div className="flex justify-between">
                            <label className="text-sm font-medium text-white">Border Radius</label>
                            <span className="text-sm text-gray-400">{themeSettings.captions.borderRadius}px</span>
                          </div>
                          <input
                            type="range"
                            min="0"
                            max="20"
                            value={themeSettings.captions.borderRadius}
                            onChange={(e) => updateCaptionSetting('borderRadius', parseInt(e.target.value))}
                            className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer progress-gradient"
                          />
                        </div>
                      </div>
                    </div>

                    {/* Shadow Settings */}
                    <div className="space-y-3">
                      <label className="text-sm font-medium text-white">Shadow</label>
                      <div className="grid grid-cols-4 gap-2">
                        {SHADOW_COLOR_PRESETS.map((shadow) => (
                          <button
                            key={shadow.value}
                            onClick={() => updateCaptionSetting('shadowColor', shadow.value)}
                            className={`relative w-full h-8 rounded-lg border-2 transition-all hover-lift ${themeSettings.captions.shadowColor === shadow.value ? 'border-white scale-105 shadow-lg shadow-white/20' : 'border-gray-600 hover:border-gray-500'}`}
                            style={{ backgroundColor: shadow.value }}
                            title={shadow.name}
                          >
                            {themeSettings.captions.shadowColor === shadow.value && (
                              <div className="absolute -top-1 -right-1 w-5 h-5 rounded-full bg-white flex items-center justify-center animate-enter shadow-md">
                                <Check className="w-3 h-3 text-black" />
                              </div>
                            )}
                          </button>
                        ))}
                      </div>

                      <div className="grid grid-cols-3 gap-4">
                        <div className="space-y-2">
                          <label className="text-sm font-medium text-white">Blur</label>
                          <input
                            type="range"
                            min="0"
                            max="20"
                            value={themeSettings.captions.shadowBlur}
                            onChange={(e) => updateCaptionSetting('shadowBlur', parseInt(e.target.value))}
                            className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer progress-gradient"
                          />
                          <span className="text-xs text-gray-400 text-center block">{themeSettings.captions.shadowBlur}px</span>
                        </div>
                        <div className="space-y-2">
                          <label className="text-sm font-medium text-white">Offset X</label>
                          <input
                            type="range"
                            min="-10"
                            max="10"
                            value={themeSettings.captions.shadowOffsetX}
                            onChange={(e) => updateCaptionSetting('shadowOffsetX', parseInt(e.target.value))}
                            className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer progress-gradient"
                          />
                          <span className="text-xs text-gray-400 text-center block">{themeSettings.captions.shadowOffsetX}px</span>
                        </div>
                        <div className="space-y-2">
                          <label className="text-sm font-medium text-white">Offset Y</label>
                          <input
                            type="range"
                            min="-10"
                            max="10"
                            value={themeSettings.captions.shadowOffsetY}
                            onChange={(e) => updateCaptionSetting('shadowOffsetY', parseInt(e.target.value))}
                            className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer progress-gradient"
                          />
                          <span className="text-xs text-gray-400 text-center block">{themeSettings.captions.shadowOffsetY}px</span>
                        </div>
                      </div>
                    </div>

                    {/* Transition Effects */}
                    <div className="space-y-3">
                      <label className="text-sm font-medium text-white">Transition Effects</label>
                      <div className="grid grid-cols-3 gap-2">
                        {(['none', 'fade', 'slide'] as const).map((transition) => (
                          <button
                            key={transition}
                            onClick={() => updateCaptionSetting('transition', transition)}
                            className={`py-2 rounded-lg text-sm transition-all hover-lift ${themeSettings.captions.transition === transition ? 'bg-blue-500/20 border border-blue-500/30 text-blue-400 shadow-lg shadow-blue-500/10' : 'bg-gray-700/50 hover:bg-gray-700 text-gray-400 hover:text-white'}`}
                          >
                            {transition === 'none' ? 'No Effect' : 
                             transition === 'fade' ? 'Fade In' : 'Slide Up'}
                          </button>
                        ))}
                      </div>
                      
                      <div className="space-y-2">
                        <div className="flex justify-between">
                          <label className="text-sm font-medium text-white">Animation Speed</label>
                          <span className="text-sm text-gray-400">{themeSettings.captions.animationSpeed}ms</span>
                        </div>
                        <input
                          type="range"
                          min="100"
                          max="1000"
                          step="50"
                          value={themeSettings.captions.animationSpeed}
                          onChange={(e) => updateCaptionSetting('animationSpeed', parseInt(e.target.value))}
                          className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer progress-gradient"
                        />
                      </div>
                    </div>
                  </div>
                )}

                {/* Templates Tab */}
                {activeSettingsTab === 'templates' && (
                  <div className="space-y-4">
                    <label className="text-sm font-medium text-white">Caption Templates</label>
                    <div className="space-y-3">
                      {CAPTION_TEMPLATES.map(template => (
                        <div
                          key={template.id}
                          onClick={() => applyTemplate(template)}
                          className="bg-gray-700/50 rounded-lg p-3 hover:bg-gray-700/70 transition-all duration-300 hover-lift cursor-pointer group"
                        >
                          <div className="flex items-center gap-3">
                            <div className="text-2xl">{template.icon}</div>
                            <div className="flex-1">
                              <div className="flex items-center justify-between">
                                <h4 className="font-medium text-white">{template.name}</h4>
                                <span className={`text-xs px-2 py-1 rounded-full ${
                                  template.category === 'professional' ? 'bg-blue-500/20 text-blue-400' :
                                  template.category === 'minimal' ? 'bg-green-500/20 text-green-400' :
                                  template.category === 'creative' ? 'bg-purple-500/20 text-purple-400' :
                                  'bg-pink-500/20 text-pink-400'
                                }`}>
                                  {template.category}
                                </span>
                              </div>
                              <p className="text-xs text-gray-400 mt-1">{template.description}</p>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                    
                    <div className="pt-4 border-t border-gray-700/50">
                      <button
                        onClick={applyStyleToAll}
                        className="w-full py-2.5 rounded-lg bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white font-medium transition-all duration-300 shadow-lg hover:shadow-xl hover-lift flex items-center justify-center gap-2"
                      >
                        <Copy className="w-4 h-4" />
                        Apply to All Captions
                      </button>
                    </div>
                  </div>
                )}

                {/* AI Tools Tab */}
                {activeSettingsTab === 'ai' && (
                  <div className="space-y-4">
                    <label className="text-sm font-medium text-white">AI-Powered Tools</label>
                    
                    {/* AI Caption Generation */}
                    <div className="bg-gradient-to-br from-blue-900/30 to-purple-900/30 rounded-lg p-4 border border-blue-500/20">
                      <div className="flex items-center gap-3 mb-3">
                        <div className="p-2 bg-blue-500/20 rounded-lg">
                          <Brain className="w-5 h-5 text-blue-400" />
                        </div>
                        <div>
                          <h4 className="font-medium text-white">Generate Captions with AI</h4>
                          <p className="text-xs text-gray-400">Automatically transcribe audio to text</p>
                        </div>
                      </div>
                      
                      <div className="space-y-3">
                        <div className="space-y-2">
                          <label className="text-xs text-gray-400">Language</label>
                          <select
                            value={selectedLanguage}
                            onChange={(e) => setSelectedLanguage(e.target.value)}
                            className="w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500/50"
                          >
                            <option value="en">English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                            <option value="hi">Hindi</option>
                          </select>
                        </div>
                        
                        {isGeneratingAI ? (
                          <div className="space-y-2">
                            <div className="flex justify-between">
                              <span className="text-sm text-gray-400">Generating captions...</span>
                              <span className="text-sm font-bold text-blue-400">{Math.round(aiProgress)}%</span>
                            </div>
                            <div className="h-2 bg-gray-700 rounded-full overflow-hidden">
                              <div 
                                className="h-full rounded-full transition-all duration-300 bg-gradient-to-r from-blue-500 to-purple-600"
                                style={{ width: `${aiProgress}%` }}
                              />
                            </div>
                          </div>
                        ) : (
                          <button
                            onClick={generateAICaptions}
                            disabled={!file}
                            className="w-full py-2.5 rounded-lg bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-medium transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                          >
                            <Lightning className="w-4 h-4" />
                            Generate AI Captions
                          </button>
                        )}
                      </div>
                    </div>

                    {/* Auto Sync */}
                    <div className="bg-gradient-to-br from-green-900/30 to-emerald-900/30 rounded-lg p-4 border border-green-500/20">
                      <div className="flex items-center gap-3 mb-3">
                        <div className="p-2 bg-green-500/20 rounded-lg">
                          <Clock className="w-5 h-5 text-green-400" />
                        </div>
                        <div>
                          <h4 className="font-medium text-white">Auto Sync Timing</h4>
                          <p className="text-xs text-gray-400">Adjust subtitle timing based on text length</p>
                        </div>
                      </div>
                      
                      <button
                        onClick={autoSyncSubtitles}
                        className="w-full py-2.5 rounded-lg bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-medium transition-all duration-300 flex items-center justify-center gap-2"
                      >
                        <ArrowUpDown className="w-4 h-4" />
                        Auto Sync Subtitles
                      </button>
                    </div>

                    {/* Import/Export */}
                    <div className="bg-gradient-to-br from-orange-900/30 to-amber-900/30 rounded-lg p-4 border border-orange-500/20">
                      <div className="flex items-center gap-3 mb-3">
                        <div className="p-2 bg-orange-500/20 rounded-lg">
                          <FileText className="w-5 h-5 text-orange-400" />
                        </div>
                        <div>
                          <h4 className="font-medium text-white">Import/Export</h4>
                          <p className="text-xs text-gray-400">Multiple subtitle formats supported</p>
                        </div>
                      </div>
                      
                      <div className="grid grid-cols-2 gap-2">
                        <button
                          onClick={() => exportSubtitles('srt')}
                          className="py-2 rounded-lg bg-gray-700/50 hover:bg-gray-700 text-gray-400 hover:text-white transition-all flex items-center justify-center gap-2 text-sm"
                        >
                          Export SRT
                        </button>
                        <button
                          onClick={() => exportSubtitles('vtt')}
                          className="py-2 rounded-lg bg-gray-700/50 hover:bg-gray-700 text-gray-400 hover:text-white transition-all flex items-center justify-center gap-2 text-sm"
                        >
                          Export VTT
                        </button>
                      </div>
                      
                      <label className="block mt-2">
                        <div className="w-full py-2 rounded-lg bg-gray-700/50 hover:bg-gray-700 text-gray-400 hover:text-white transition-all flex items-center justify-center gap-2 text-sm cursor-pointer">
                          Import Subtitles
                        </div>
                        <input
                          type="file"
                          accept=".srt,.vtt,.txt"
                          onChange={importSubtitles}
                          className="hidden"
                        />
                      </label>
                    </div>
                  </div>
                )}

                {/* Timeline Tab */}
                {activeSettingsTab === 'timeline' && (
                  <div className="space-y-4">
                    <label className="text-sm font-medium text-white">Timeline Editor</label>
                    
                    <div className="space-y-2">
                      <div className="flex justify-between items-center">
                        <span className="text-xs text-gray-400">Video Duration: {formatDuration(videoDuration)}</span>
                        <button
                          onClick={() => setShowTimeline(!showTimeline)}
                          className="text-xs text-blue-400 hover:text-blue-300"
                        >
                          {showTimeline ? 'Hide Timeline' : 'Show Timeline'}
                        </button>
                      </div>
                      
                      {showTimeline && (
                        <div className="relative h-32 bg-gray-900/50 rounded-lg p-2">
                          <div className="absolute inset-0 flex items-center">
                            {/* Timeline Scale */}
                            <div className="w-full h-px bg-gray-600"></div>
                          </div>
                          
                          {/* Subtitle Markers */}
                          {subtitles.map((sub, index) => {
                            const left = (sub.startTime / videoDuration) * 100
                            const width = ((sub.endTime - sub.startTime) / videoDuration) * 100
                            
                            return (
                              <div
                                key={sub.id}
                                className="absolute top-1/2 -translate-y-1/2 h-6 rounded bg-gradient-to-r from-blue-500/50 to-purple-500/50 border border-blue-400/30 cursor-pointer hover:scale-105 transition-transform"
                                style={{
                                  left: `${left}%`,
                                  width: `${width}%`,
                                  minWidth: '20px'
                                }}
                                title={`${formatDuration(sub.startTime)} - ${formatDuration(sub.endTime)}\n${sub.text}`}
                              >
                                <div className="absolute -top-5 left-0 text-xs text-gray-400 whitespace-nowrap">
                                  {formatDuration(sub.startTime)}
                                </div>
                                <div className="absolute inset-0 flex items-center justify-center">
                                  <span className="text-xs font-medium text-white truncate px-1">
                                    {index + 1}
                                  </span>
                                </div>
                              </div>
                            )
                          })}
                          
                          {/* Current Time Marker */}
                          {videoRef.current && (
                            <div
                              className="absolute top-0 bottom-0 w-0.5 bg-red-500"
                              style={{
                                left: `${(videoRef.current.currentTime / videoDuration) * 100}%`
                              }}
                            >
                              <div className="absolute -top-6 left-1/2 -translate-x-1/2 bg-red-500 text-white text-xs px-2 py-1 rounded-lg whitespace-nowrap">
                                {formatDuration(videoRef.current.currentTime)}
                              </div>
                            </div>
                          )}
                        </div>
                      )}
                    </div>
                    
                    {/* Subtitle Stats */}
                    <div className="space-y-2">
                      <label className="text-sm font-medium text-white">Statistics</label>
                      <div className="grid grid-cols-2 gap-2">
                        <div className="bg-gray-700/30 rounded-lg p-3">
                          <div className="text-2xl font-bold text-white">{subtitles.length}</div>
                          <div className="text-xs text-gray-400">Total Captions</div>
                        </div>
                        <div className="bg-gray-700/30 rounded-lg p-3">
                          <div className="text-2xl font-bold text-white">{captionStats.totalWords}</div>
                          <div className="text-xs text-gray-400">Total Words</div>
                        </div>
                        <div className="bg-gray-700/30 rounded-lg p-3">
                          <div className="text-2xl font-bold text-white">{formatDuration(captionStats.estimatedReadTime)}</div>
                          <div className="text-xs text-gray-400">Read Time</div>
                        </div>
                        <div className="bg-gray-700/30 rounded-lg p-3">
                          <div className="text-2xl font-bold text-white">{captionStats.avgDuration.toFixed(1)}s</div>
                          <div className="text-xs text-gray-400">Avg Duration</div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {/* Subtitle Management */}
                <div className="space-y-3 pt-4 border-t border-gray-700/50">
                  <div className="flex justify-between items-center">
                    <label className="text-sm font-medium text-white">Subtitles</label>
                    <div className="flex items-center gap-2">
                      <span className="text-xs text-blue-400 bg-blue-500/10 px-2 py-1 rounded-full border border-blue-500/20">
                        {subtitles.length} items
                      </span>
                      <button
                        onClick={() => setShowAllCaptions(!showAllCaptions)}
                        className="p-1 hover:bg-gray-700/50 rounded-lg transition-colors"
                        title={showAllCaptions ? "Show only active" : "Show all"}
                      >
                        {showAllCaptions ? <EyeOff className="w-3 h-3" /> : <Eye className="w-3 h-3" />}
                      </button>
                    </div>
                  </div>
                  <div className="space-y-2">
                    {subtitles.map((subtitle) => (
                      <div 
                        key={subtitle.id} 
                        className={`bg-gray-700/50 rounded-lg p-3 hover:bg-gray-700/70 transition-all duration-300 hover-lift group ${
                          currentSubtitle?.id === subtitle.id ? 'ring-2 ring-blue-500/30' : ''
                        }`}
                      >
                        <div className="flex justify-between items-start mb-2">
                          <div className="flex items-center gap-2">
                            <span className="text-xs text-gray-400 group-hover:text-blue-400 transition-colors">
                              {formatDuration(subtitle.startTime)} - {formatDuration(subtitle.endTime)}
                            </span>
                            {currentSubtitle?.id === subtitle.id && (
                              <span className="text-xs px-1.5 py-0.5 bg-green-500/20 text-green-400 rounded-full border border-green-500/30 animate-pulse">
                                Now
                              </span>
                            )}
                            {subtitle.isAutoGenerated && (
                              <span className="text-xs px-1.5 py-0.5 bg-purple-500/20 text-purple-400 rounded-full border border-purple-500/30">
                                AI
                              </span>
                            )}
                          </div>
                          <div className="flex gap-1">
                            <button
                              onClick={() => duplicateSubtitle(subtitle.id)}
                              className="p-1 hover:bg-blue-500/20 rounded-lg transition-colors opacity-0 group-hover:opacity-100"
                              title="Duplicate"
                            >
                              <Copy className="w-3 h-3 text-blue-400" />
                            </button>
                            <button
                              onClick={() => editTimeRange(subtitle.id)}
                              className="p-1 hover:bg-blue-500/20 rounded-lg transition-colors opacity-0 group-hover:opacity-100"
                              title="Edit time range"
                            >
                              <Clock className="w-3 h-3 text-blue-400" />
                            </button>
                            <button
                              onClick={() => deleteSubtitle(subtitle.id)}
                              className="p-1 hover:bg-red-500/20 rounded-lg transition-colors opacity-0 group-hover:opacity-100"
                              title="Delete subtitle"
                            >
                              <Trash2 className="w-3 h-3 text-red-400" />
                            </button>
                          </div>
                        </div>
                        
                        {/* Time Range Editor */}
                        {editingSubtitleId === subtitle.id && (
                          <div className="mb-3 p-3 bg-gray-800/50 rounded-lg animate-slide-up">
                            <div className="flex items-center justify-between mb-2">
                              <span className="text-sm font-medium text-white">Set Time Range</span>
                              <div className="flex gap-2">
                                <button
                                  onClick={saveTimeRange}
                                  className="px-2 py-1 bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 text-xs rounded-lg transition-colors"
                                >
                                  Save
                                </button>
                                <button
                                  onClick={cancelTimeRangeEdit}
                                  className="px-2 py-1 bg-gray-700 hover:bg-gray-600 text-gray-400 text-xs rounded-lg transition-colors"
                                >
                                  Cancel
                                </button>
                              </div>
                            </div>
                            <div className="space-y-3">
                              <div className="space-y-1">
                                <label className="text-xs text-gray-400">Start Time (seconds)</label>
                                <input
                                  type="number"
                                  min="0"
                                  max={videoDuration}
                                  step="0.1"
                                  value={timeRange.start}
                                  onChange={(e) => setTimeRange(prev => ({ ...prev, start: parseFloat(e.target.value) }))}
                                  className="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm"
                                />
                                <div className="flex items-center gap-2">
                                  <span className="text-xs text-gray-500">{formatDuration(timeRange.start)}</span>
                                  <input
                                    type="range"
                                    min="0"
                                    max={videoDuration || 60}
                                    step="0.5"
                                    value={timeRange.start}
                                    onChange={(e) => setTimeRange(prev => ({ ...prev, start: parseFloat(e.target.value) }))}
                                    className="flex-1 h-1.5 bg-gray-600 rounded-full appearance-none cursor-pointer"
                                  />
                                </div>
                              </div>
                              <div className="space-y-1">
                                <label className="text-xs text-gray-400">End Time (seconds)</label>
                                <input
                                  type="number"
                                  min={timeRange.start + 0.5}
                                  max={videoDuration}
                                  step="0.1"
                                  value={timeRange.end}
                                  onChange={(e) => setTimeRange(prev => ({ ...prev, end: parseFloat(e.target.value) }))}
                                  className="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm"
                                />
                                <div className="flex items-center gap-2">
                                  <span className="text-xs text-gray-500">{formatDuration(timeRange.end)}</span>
                                  <input
                                    type="range"
                                    min={timeRange.start + 0.5}
                                    max={videoDuration || 60}
                                    step="0.5"
                                    value={timeRange.end}
                                    onChange={(e) => setTimeRange(prev => ({ ...prev, end: parseFloat(e.target.value) }))}
                                    className="flex-1 h-1.5 bg-gray-600 rounded-full appearance-none cursor-pointer"
                                  />
                                </div>
                              </div>
                              <div className="text-xs text-gray-500 pt-2 border-t border-gray-700/50">
                                Subtitle will be visible from {formatDuration(timeRange.start)} to {formatDuration(timeRange.end)}
                              </div>
                            </div>
                          </div>
                        )}
                        
                        <textarea
                          value={subtitle.text}
                          onChange={(e) => updateSubtitleText(subtitle.id, e.target.value)}
                          className="w-full bg-transparent text-white text-sm border-none outline-none placeholder-gray-500 resize-none h-12 focus:ring-2 focus:ring-blue-500/30 focus:bg-gray-800/30 rounded p-2 transition-all"
                          placeholder="Edit subtitle text..."
                          rows={2}
                        />
                      </div>
                    ))}
                  </div>
                  <button
                    onClick={addNewSubtitle}
                    className="w-full py-2.5 rounded-lg bg-gray-700/50 hover:bg-gray-700 text-gray-400 hover:text-white transition-all duration-300 flex items-center justify-center gap-2 hover-lift"
                  >
                    <Plus className="w-4 h-4" />
                    Add New Subtitle
                  </button>
                </div>

                {/* Action Buttons */}
                <div className="space-y-3 pt-4 border-t border-gray-700/50">
                  <button
                    onClick={applyStyleToAll}
                    className="w-full py-3 rounded-lg bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white font-medium transition-all duration-300 shadow-lg hover:shadow-xl hover-lift flex items-center justify-center gap-2"
                  >
                    <Check className="w-4 h-4" />
                    Apply to All Captions
                  </button>
                  <div className="text-xs text-gray-500 text-center">
                    Styles are baked into final video output
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* Enhanced Center Panel - Video Preview */}
          <div className={`transition-all duration-500 ${isCaptionPanelOpen ? 'col-span-8' : 'col-span-12'}`}>
            <div className="bg-gray-800/50 backdrop-blur-sm rounded-2xl border border-gray-700/50 p-8 hover-lift transition-all duration-300 hover:border-blue-500/30">
              <div className="flex items-center justify-between mb-8">
                <div>
                  <h2 className="text-2xl font-bold text-white mb-2 flex items-center gap-3">
                    <span className="gradient-text">Video Preview</span>
                    {file && (
                      <span className="text-xs px-2 py-1 bg-green-500/20 text-green-400 rounded-full border border-green-500/30 animate-pulse">
                        LIVE PREVIEW
                      </span>
                    )}
                  </h2>
                  <p className="text-gray-400 flex items-center gap-2">
                    {file ? (
                      <>
                        <span className="text-blue-400">Preview with real-time caption styles</span>
                        <span className="text-white font-medium">{file.name}</span>
                      </>
                    ) : (
                      "Upload a video to begin editing"
                    )}
                  </p>
                </div>
                <div className="flex items-center gap-3">
                  <div className="flex items-center gap-2">
                    <button
                      onClick={() => setIsCaptionPanelOpen(!isCaptionPanelOpen)}
                      className="flex items-center gap-2 px-4 py-2 bg-gray-800/50 hover:bg-gray-700/50 rounded-xl transition-all duration-300 border border-gray-700/50 hover:border-blue-500/30 hover-lift"
                    >
                      {isCaptionPanelOpen ? <EyeOff className="w-4 h-4" /> : <Eye className="w-4 h-4" />}
                      <span className="text-sm font-medium text-white hidden md:inline">
                        {isCaptionPanelOpen ? 'Hide Settings' : 'Show Settings'}
                      </span>
                    </button>
                    
                    {/* Export Options */}
                    <div className="relative">
                      <button
                        onClick={() => setShowExportOptions(!showExportOptions)}
                        className="flex items-center gap-2 px-4 py-2 bg-gray-800/50 hover:bg-gray-700/50 rounded-xl transition-all duration-300 border border-gray-700/50 hover:border-blue-500/30 hover-lift"
                      >
                        <Share2 className="w-4 h-4" />
                        <span className="text-sm font-medium text-white hidden md:inline">Export</span>
                      </button>
                      
                      {showExportOptions && (
                        <div className="absolute top-full right-0 mt-2 w-48 bg-gray-800 backdrop-blur-sm rounded-xl border border-gray-700/50 p-2 shadow-2xl animate-slide-down z-50">
                          <button
                            onClick={() => exportSubtitles('srt')}
                            className="w-full py-2 px-3 rounded-lg text-left text-sm text-gray-300 hover:bg-gray-700/50 transition-colors"
                          >
                            Export as SRT
                          </button>
                          <button
                            onClick={() => exportSubtitles('vtt')}
                            className="w-full py-2 px-3 rounded-lg text-left text-sm text-gray-300 hover:bg-gray-700/50 transition-colors"
                          >
                            Export as VTT
                          </button>
                          <button
                            onClick={() => exportSubtitles('txt')}
                            className="w-full py-2 px-3 rounded-lg text-left text-sm text-gray-300 hover:bg-gray-700/50 transition-colors"
                          >
                            Export as Text
                          </button>
                          <button
                            onClick={saveProject}
                            className="w-full py-2 px-3 rounded-lg text-left text-sm text-gray-300 hover:bg-gray-700/50 transition-colors"
                          >
                            Save Project
                          </button>
                        </div>
                      )}
                    </div>
                  </div>
                  
                  {videoUrl && (
                    <button
                      onClick={handleDownload}
                      className="flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-green-600 to-emerald-700 hover:from-green-500 hover:to-emerald-600 text-white font-medium rounded-lg transition-all duration-300 shadow-lg hover:shadow-xl hover-lift group"
                    >
                      <Download className="w-4 h-4 group-hover:animate-bounce-subtle" />
                      <span className="hidden md:inline">Download Final Video</span>
                    </button>
                  )}
                </div>
              </div>

              {/* Video Player */}
              <div className="space-y-6">
                {/* Video Container */}
                <div className="relative rounded-xl overflow-hidden border-2 border-blue-500/30 bg-gray-900 aspect-video group hover:border-blue-500/50 transition-all duration-300">
                  {file || videoUrl ? (
                    <>
                      <video
                        ref={videoRef}
                        src={getVideoSrc()}
                        controls
                        className="w-full h-full"
                        style={getVideoFilterStyle()}
                        autoPlay
                      />
                      
                      {/* DYNAMIC SUBTITLE OVERLAY */}
                      {(file && currentSubtitle) || (showAllCaptions && subtitles.length > 0) ? (
                        <div 
                          key={`subtitle-${currentSubtitle?.id || 'all'}-${forceUpdate}`}
                          className="absolute left-0 right-0 px-4 z-10 pointer-events-none animate-fade-in"
                          style={getSubtitlePositionStyle()}
                        >
                          <div 
                            className="mx-auto transition-all duration-300 hover:scale-105"
                            style={{
                              ...getCaptionStyle(),
                              maxWidth: `${themeSettings.captions.maxWidth}px`,
                              margin: '0 auto',
                              boxShadow: `${themeSettings.captions.shadowOffsetX}px ${themeSettings.captions.shadowOffsetY}px ${themeSettings.captions.shadowBlur}px ${themeSettings.captions.shadowColor}, 0 0 30px rgba(59, 130, 246, 0.1)`,
                            }}
                          >
                            {showAllCaptions ? (
                              <div className="space-y-2">
                                {subtitles.map((sub, index) => (
                                  <div 
                                    key={sub.id}
                                    className={`p-2 rounded ${currentSubtitle?.id === sub.id ? 'bg-blue-500/20' : 'bg-gray-900/50'}`}
                                  >
                                    <div className="text-xs text-gray-400 mb-1">
                                      {formatDuration(sub.startTime)} - {formatDuration(sub.endTime)}
                                    </div>
                                    {sub.text}
                                  </div>
                                ))}
                              </div>
                            ) : (
                              currentSubtitle?.text
                            )}
                          </div>
                        </div>
                      ) : null}

                      {/* Current Time Display */}
                      <div className="absolute bottom-4 left-4 bg-black/80 backdrop-blur-sm rounded-lg px-3 py-1.5 z-10 animate-slide-up">
                        <span className="text-white text-sm font-medium flex items-center gap-2">
                          <Clock className="w-3 h-3" />
                          {videoRef.current ? formatDuration(videoRef.current.currentTime) : "0:00"}
                        </span>
                      </div>

                      {/* Style Demo Badge */}
                      <div className="absolute top-4 right-4 z-10 animate-slide-up">
                        <div className="px-3 py-1.5 bg-black/80 backdrop-blur-sm rounded-lg">
                          <span className="text-white text-sm font-medium flex items-center gap-2">
                            <Type className="w-3 h-3 text-blue-400" />
                            Style: {themeSettings.captions.bold ? 'Bold' : 'Regular'}
                            {themeSettings.captions.italic ? '+Italic' : ''}
                            {themeSettings.captions.underline ? '+Underline' : ''}
                          </span>
                        </div>
                      </div>

                      {/* Volume Control */}
                      <div className="absolute bottom-4 right-4 bg-black/80 backdrop-blur-sm rounded-lg px-3 py-1.5 z-10 animate-slide-up">
                        <div className="flex items-center gap-2">
                          <Volume2 className="w-3 h-3 text-white" />
                          <input
                            type="range"
                            min="0"
                            max="100"
                            value={themeSettings.video.volume}
                            onChange={(e) => updateVideoSetting('volume', parseInt(e.target.value))}
                            className="w-20 h-1 bg-gray-600 rounded-full appearance-none cursor-pointer"
                          />
                          <span className="text-xs text-white w-8">{themeSettings.video.volume}%</span>
                        </div>
                      </div>
                    </>
                  ) : (
                    <div className="w-full h-full flex items-center justify-center bg-gray-800/50">
                      <div className="text-center animate-fade-in">
                        <div className="w-24 h-24 rounded-full bg-gray-700/50 border-4 border-gray-600 flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-500">
                          <Play className="w-12 h-12 text-gray-600 group-hover:text-blue-400 transition-colors" />
                        </div>
                        <h3 className="text-xl font-semibold text-gray-500 mb-2">Upload a video to begin</h3>
                        <p className="text-gray-600 max-w-md">
                          Add captions with styles that get baked into the final video output
                        </p>
                      </div>
                    </div>
                  )}

                  {/* Demo Overlay */}
                  {!file && showDemoOverlay && (
                    <div className="absolute inset-0 bg-gradient-to-t from-gray-900/90 to-transparent flex items-end justify-center p-8 animate-fade-in">
                      <div className="text-center bg-gray-800/80 backdrop-blur-sm rounded-xl p-6 max-w-lg">
                        <h4 className="text-lg font-semibold text-white mb-2">See Caption Styles in Action</h4>
                        <p className="text-gray-300 mb-4">
                          Upload a video to see real-time preview of caption styles. All styles are applied directly to the final video output.
                        </p>
                        <div className="flex gap-3 justify-center">
                          <div 
                            className="px-4 py-2 rounded-lg text-white text-sm border border-blue-500/30"
                            style={getCaptionStyle()}
                          >
                            Demo Caption
                          </div>
                          <button
                            onClick={() => setShowDemoOverlay(false)}
                            className="px-4 py-2 bg-gray-700/50 hover:bg-gray-700 rounded-lg text-gray-300 text-sm transition-colors"
                          >
                            Hide Demo
                          </button>
                        </div>
                      </div>
                    </div>
                  )}
                </div>

                {/* Current Subtitle Info */}
                {currentSubtitle && (
                  <div className="bg-gray-800/30 rounded-xl p-4 animate-fade-in hover-lift transition-all duration-300">
                    <div className="flex items-center gap-3">
                      <div className="p-2 bg-blue-500/20 rounded-lg group-hover:scale-110 transition-transform">
                        <TextCursor className="w-5 h-5 text-blue-400 animate-pulse-subtle" />
                      </div>
                      <div className="flex-1">
                        <div className="flex justify-between items-start">
                          <div>
                            <p className="text-sm text-gray-400 mb-1">Active Caption ‚Ä¢ Applies to final video</p>
                            <p className="text-lg font-semibold text-white mb-1">{currentSubtitle.text}</p>
                          </div>
                          <button
                            onClick={() => duplicateSubtitle(currentSubtitle.id)}
                            className="p-2 hover:bg-blue-500/20 rounded-lg transition-colors"
                            title="Duplicate"
                          >
                            <Copy className="w-4 h-4 text-blue-400" />
                          </button>
                        </div>
                        <p className="text-xs text-gray-500 flex items-center gap-2">
                          <span>{formatDuration(currentSubtitle.startTime)} - {formatDuration(currentSubtitle.endTime)}</span>
                          <span className="text-gray-600">‚Ä¢</span>
                          <span>Subtitle #{subtitles.findIndex(s => s.id === currentSubtitle.id) + 1}</span>
                          <span className="text-gray-600">‚Ä¢</span>
                          <span className="text-green-400">‚úì Styles baked into output</span>
                          {currentSubtitle.isAutoGenerated && (
                            <>
                              <span className="text-gray-600">‚Ä¢</span>
                              <span className="text-purple-400">AI Generated</span>
                            </>
                          )}
                        </p>
                      </div>
                    </div>
                  </div>
                )}

                {/* Upload & Generate Section */}
                <div className="bg-gray-800/30 rounded-xl p-6">
                  <div className="grid grid-cols-2 gap-6">
                    {/* Upload Section */}
                    <div>
                      <h3 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                        <Upload className="w-5 h-5 text-blue-400" />
                        Upload Video
                      </h3>
                      <label className={`block relative border-2 ${file ? 'border-green-500/50 shadow-lg shadow-green-500/20' : 'border-dashed border-gray-600/50 hover:border-blue-500/50'} rounded-xl p-6 transition-all duration-300 hover:bg-gray-800/30 cursor-pointer group`}>
                        <div className="text-center">
                          <div className="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-700/50 mb-4 group-hover:scale-110 transition-transform duration-500">
                            {file ? (
                              <Video className="w-8 h-8 text-green-400" />
                            ) : (
                              <Upload className="w-8 h-8 text-gray-400 group-hover:text-blue-400 transition-colors" />
                            )}
                          </div>
                          <h3 className="font-medium text-white mb-2">
                            {file ? file.name : "Click to upload video"}
                          </h3>
                          <div className="relative overflow-hidden">
                            <div className="px-5 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 group-hover:from-blue-500 group-hover:to-blue-600 text-white font-medium rounded-lg transition-all duration-300 inline-block hover-lift shadow-lg group-hover:shadow-xl">
                              {file ? "Change Video" : "Browse Files"}
                            </div>
                          </div>
                        </div>
                        <input
                          type="file"
                          accept="video/*"
                          className="hidden"
                          onChange={(e) => {
                            const selectedFile = e.target.files?.[0] || null
                            setFile(selectedFile)
                            setVideoUrl("")
                            setCurrentSubtitle(null)
                          }}
                        />
                      </label>
                    </div>

                    {/* Generate Button */}
                    <div>
                      <h3 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                        <Sparkles className="w-5 h-5 text-purple-400" />
                        Generate Final Video
                      </h3>
                      <button
                        onClick={generate}
                        disabled={loading || !file}
                        className="w-full group relative overflow-hidden py-4 px-6 rounded-xl bg-gradient-to-r from-blue-600 via-blue-700 to-purple-700 hover:from-blue-500 hover:via-blue-600 hover:to-purple-600 text-white font-semibold text-lg transition-all duration-500 disabled:opacity-50 disabled:cursor-not-allowed shadow-2xl hover:shadow-3xl active:scale-[0.98] border border-blue-500/30 hover:border-blue-400/50 hover-lift transform hover:-translate-y-0.5"
                      >
                        <div className="relative z-10 flex items-center justify-center gap-3">
                          {loading ? (
                            <>
                              <Loader2 className="w-5 h-5 animate-spin" />
                              <span>Processing...</span>
                            </>
                          ) : (
                            <>
                              <Sparkles className="w-5 h-5 group-hover:rotate-12 transition-transform duration-300 group-hover:text-yellow-300" />
                              <span className="bg-gradient-to-r from-white to-blue-100 bg-clip-text text-transparent">
                                Generate Final Video
                              </span>
                            </>
                          )}
                        </div>
                        
                        {/* Processing complete effect */}
                        {isProcessingComplete && (
                          <div className="absolute inset-0 bg-gradient-to-r from-green-500/20 to-emerald-500/20 animate-pulse rounded-xl" />
                        )}
                      </button>

                      {/* Progress Bar */}
                      {loading && (
                        <div className="mt-4">
                          <div className="flex items-center justify-between mb-2">
                            <span className="text-sm text-gray-400">Processing video with captions...</span>
                            <span className="text-sm font-bold text-blue-400">{Math.round(uploadProgress)}%</span>
                          </div>
                          <div className="h-2 bg-gray-700 rounded-full overflow-hidden">
                            <div 
                              className="h-full rounded-full transition-all duration-300 bg-gradient-to-r from-blue-500 to-purple-600"
                              style={{ width: `${uploadProgress}%` }}
                            />
                          </div>
                        </div>
                      )}

                      {/* Video Settings */}
                      {file && (
                        <div className="mt-4 space-y-2">
                          <div className="space-y-2">
                            <div className="flex justify-between">
                              <label className="text-sm font-medium text-white">Brightness</label>
                              <span className="text-sm text-gray-400">{themeSettings.video.brightness}%</span>
                            </div>
                            <input
                              type="range"
                              min="0"
                              max="200"
                              value={themeSettings.video.brightness}
                              onChange={(e) => updateVideoSetting('brightness', parseInt(e.target.value))}
                              className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer progress-gradient"
                            />
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                </div>

                {/* Enhanced Stats Grid */}
                {(file || videoUrl) && (
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div className="bg-gray-700/30 rounded-xl p-4 hover-lift transition-all duration-300 group">
                      <div className="flex items-center gap-3">
                        <div className="p-2 bg-blue-500/20 rounded-lg group-hover:scale-110 transition-transform">
                          <Clock className="w-5 h-5 text-blue-400" />
                        </div>
                        <div>
                          <p className="text-sm text-gray-400 group-hover:text-blue-400 transition-colors">Duration</p>
                          <p className="text-lg font-semibold text-white">{formatDuration(videoDuration)}</p>
                        </div>
                      </div>
                    </div>
                    <div className="bg-gray-700/30 rounded-xl p-4 hover-lift transition-all duration-300 group">
                      <div className="flex items-center gap-3">
                        <div className="p-2 bg-green-500/20 rounded-lg group-hover:scale-110 transition-transform">
                          <Type className="w-5 h-5 text-green-400" />
                        </div>
                        <div>
                          <p className="text-sm text-gray-400 group-hover:text-green-400 transition-colors">Caption Style</p>
                          <p className="text-lg font-semibold text-white">
                            {themeSettings.captions.bold ? 'Bold' : 'Regular'}
                            {themeSettings.captions.italic ? ', Italic' : ''}
                          </p>
                        </div>
                      </div>
                    </div>
                    <div className="bg-gray-700/30 rounded-xl p-4 hover-lift transition-all duration-300 group">
                      <div className="flex items-center gap-3">
                        <div className="p-2 bg-purple-500/20 rounded-lg group-hover:scale-110 transition-transform">
                          <Video className="w-5 h-5 text-purple-400" />
                        </div>
                        <div>
                          <p className="text-sm text-gray-400 group-hover:text-purple-400 transition-colors">Resolution</p>
                          <p className="text-lg font-semibold text-white">
                            {videoResolution.width || 1280} √ó {videoResolution.height || 720}
                          </p>
                        </div>
                      </div>
                    </div>
                    <div className="bg-gray-700/30 rounded-xl p-4 hover-lift transition-all duration-300 group">
                      <div className="flex items-center gap-3">
                        <div className="p-2 bg-orange-500/20 rounded-lg group-hover:scale-110 transition-transform">
                          <PieChart className="w-5 h-5 text-orange-400" />
                        </div>
                        <div>
                          <p className="text-sm text-gray-400 group-hover:text-orange-400 transition-colors">Caption Stats</p>
                          <p className="text-lg font-semibold text-white">
                            {captionStats.totalWords} words
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Enhanced Status Bar */}
      <div className="fixed bottom-0 left-0 right-0 bg-gray-900/95 backdrop-blur-lg border-t border-gray-700/50 z-50 animate-slide-up">
        <div className="container mx-auto px-8 py-3">
          <div className="flex flex-col md:flex-row items-center justify-between text-sm gap-2">
            <div className="flex items-center gap-4 flex-wrap">
              <div className="flex items-center gap-2">
                <div className={`w-2 h-2 rounded-full ${file ? 'bg-green-500 animate-pulse' : 'bg-gray-500'}`}></div>
                <span className="text-gray-300">
                  {file ? `Ready: ${file.name}` : "No video selected"}
                </span>
              </div>
              {videoDuration > 0 && (
                <>
                  <div className="hidden md:block text-gray-500">|</div>
                  <div className="text-gray-400">
                    Duration: {formatDuration(videoDuration)}
                  </div>
                </>
              )}
              {currentSubtitle && (
                <>
                  <div className="hidden md:block text-gray-500">|</div>
                  <div className="text-blue-400 flex items-center gap-2">
                    <Captions className="w-3 h-3" />
                    Active caption with baked-in styles
                  </div>
                </>
              )}
            </div>
            <div className="flex items-center gap-4 text-gray-400">
              <div className="hidden md:flex items-center gap-2">
                <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                <span>Captions baked into final output</span>
              </div>
              <div className="hidden md:block text-gray-500">|</div>
              <div className="flex items-center gap-2">
                <Command className="w-3 h-3" />
                <span className="text-blue-400">Keyboard shortcuts available</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Enhanced Floating action buttons */}
      {file && !loading && (
        <div className="fixed bottom-24 right-8 flex flex-col gap-3 z-40">
          <button
            onClick={() => videoRef.current?.play()}
            className="w-14 h-14 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center shadow-2xl hover:shadow-3xl transition-all duration-300 hover-lift animate-bounce-subtle"
            title="Play/Pause (Space)"
          >
            <Play className="w-6 h-6 text-white" />
          </button>
          
          {currentSubtitle && (
            <button
              onClick={() => duplicateSubtitle(currentSubtitle.id)}
              className="w-14 h-14 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center shadow-2xl hover:shadow-3xl transition-all duration-300 hover-lift animate-bounce-subtle"
              title="Duplicate (Ctrl/Cmd + D)"
            >
              <Copy className="w-6 h-6 text-white" />
            </button>
          )}
          
          <button
            onClick={saveProject}
            className="w-14 h-14 bg-gradient-to-br from-orange-500 to-amber-600 rounded-full flex items-center justify-center shadow-2xl hover:shadow-3xl transition-all duration-300 hover-lift animate-bounce-subtle"
            title="Save Project (Ctrl/Cmd + S)"
          >
            <Save className="w-6 h-6 text-white" />
          </button>
        </div>
      )}

      {/* Animation styles */}
      <style jsx>{`
        @keyframes slideUp {
          from { transform: translateY(10px); opacity: 0; }
          to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes fade-in {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes slide-down {
          from { transform: translateY(-10px); opacity: 0; }
          to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes slide-in-right {
          from { transform: translateX(20px); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulse-subtle {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.7; }
        }
        
        @keyframes float {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-10px); }
        }
        
        @keyframes glow {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
        
        @keyframes bounce-subtle {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-5px); }
        }
        
        @keyframes spin-slow {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
        
        @keyframes enter {
          from { transform: scale(0); opacity: 0; }
          to { transform: scale(1); opacity: 1; }
        }
        
        .hover-lift:hover {
          transform: translateY(-2px);
        }
        
        .gradient-text {
          background: linear-gradient(45deg, #667eea, #764ba2, #ec4899);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
        }
        
        .progress-gradient {
          background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
        }
        
        input[type="range"] {
          -webkit-appearance: none;
          background: transparent;
        }
        
        input[type="range"]::-webkit-slider-thumb {
          -webkit-appearance: none;
          width: 20px;
          height: 20px;
          background: white;
          border: 2px solid #3b82f6;
          border-radius: 50%;
          cursor: pointer;
          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        .scrollbar-thin::-webkit-scrollbar {
          width: 6px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-track {
          background: rgba(75, 85, 99, 0.1);
          border-radius: 10px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb {
          background: linear-gradient(45deg, #3b82f6, #8b5cf6);
          border-radius: 10px;
        }
        
        .animate-enter {
          animation: enter 0.2s ease-out;
        }
      `}</style>
    </main>
  )
}